extends layout

block heading
  script(type='text/javascript', src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDX4Fw2VFDqPU46MERB-3Z5IXTaaXWhF1Y&sensor=false")
  script(type='text/javascript')
    var map;
    function initialize() {
      var mapOptions = {
        center: new google.maps.LatLng(39.8282, -98.5795),
        zoom: 4,
        mapTypeId: google.maps.MapTypeId.ROADMAP
      };
      map = new google.maps.Map(document.getElementById("map_canvas"),
          mapOptions);
    }

    function makeMarker(c0, c1, size, color, tweets) {
      var latLng = new google.maps.LatLng(parseFloat(c0), parseFloat(c1));
      var marker = new google.maps.Marker({
        position: latLng,
        map: map,
        icon: getCircle(size, color)
      });
      onClick(marker, tweets);
    }

    function getCircle(size, color) {
      return {
        path: google.maps.SymbolPath.CIRCLE,
        fillColor: color,
        fillOpacity: .5,
        scale: size/2,
        strokeColor: 'white',
        strokeWeight: .5
      };
    }

    function onClick(marker, tweets) {
      var message = tweets;
      //- var infowindow = new google.maps.InfoWindow(
      //-     { content: message,
      //-       size: new google.maps.Size(50,50)
      //-     });
      google.maps.event.addListener(marker, 'click', function() {
        //- infowindow.open(map,marker);
      });
    }

block content
  .container(style='height:100%')
    .row-fluid(style='height:100%')
      .span8(style='height:100%')
        p Sentiment Legend: yellow = positive, blue = negative, gray = neutral
        #map_canvas(style='width:95%; height:90%')
      h1= "map info"
      div(id="container2")
        each tweet_properties, location in tweets
          div(id="wrapper")
            p Location: #{location}
            //- each location has tweets, number tweets, sentiments, and average sentiment
            p Number of tweets: #{tweet_properties[2]}
            p Average sentiment: #{tweet_properties[3]}
            p Tweets: #{tweet_properties[0]}
            p Sentiments: #{tweet_properties[1]}

  script(type='text/javascript')
    initialize();
  each info, loc in tweets
    script(type='text/javascript')
      var avg_sent = #{info[3]};

      //- variables used for yellow-blue color scheme
      var rg = Math.round(avg_sent/4*255);
      var blue = Math.round((avg_sent-4)/-4*255);

      //- variables used for red-black color scheme
      var red = Math.round(avg_sent/4*255);
      if (avg_sent <= 2)
        var bg = Math.round(avg_sent/2*64);
      else
        var bg = Math.round((avg_sent-4)/-2*64);
        
      //- makeMarker(parseFloat('#{info[4][0]}'), parseFloat('#{info[4][1]}'), parseFloat('#{info[2]}'), 'rgb('+red+','+bg+','+bg+')', 'surprise');
      makeMarker(parseFloat('#{info[4][0]}'), parseFloat('#{info[4][1]}'), parseFloat('#{info[2]}'), 'rgb('+rg+','+rg+','+blue+')', 'surprise');
